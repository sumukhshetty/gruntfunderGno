

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tournament Operation &mdash; gnosis.js  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="gnosis.js  documentation" href="index.html"/>
        <link rel="up" title="Developer Guide" href="developer-guide.html"/>
        <link rel="next" title="API Reference" href="api-reference.html"/>
        <link rel="prev" title="LMSR Primer" href="lmsr-primer.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> gnosis.js
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="developer-guide.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-overview.html">API Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="events-oracles-and-markets.html">Events, Oracles and Markets</a></li>
<li class="toctree-l2"><a class="reference internal" href="lmsr-primer.html">LMSR Primer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tournament Operation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#smart-contracts">Smart Contracts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#token-contracts">Token Contracts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deployment-to-a-public-network">Deployment to a Public Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preserving-deployment-information-in-published-packages">Preserving Deployment Information in Published Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tying-a-bow-and-shipping-it">Tying a Bow and Shipping It</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gnosisdb">GnosisDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-interface">Setting Up the Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">gnosis.js</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="developer-guide.html">Developer Guide</a> &raquo;</li>
        
      <li>Tournament Operation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tournament-operation.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tournament-operation">
<span id="tournament-operation"></span><h1>Tournament Operation<a class="headerlink" href="#tournament-operation" title="Permalink to this headline">¶</a></h1>
<p>Towards the end of 2017, Gnosis hosted a prediction market tournament called <a class="reference external" href="https://blog.gnosis.pm/announcing-gnosis-olympia-5fb7e16dd259">Olympia</a>. It combined <a class="reference external" href="https://github.com/gnosis/gnosisdb">GnosisDB</a>, the <a class="reference external" href="https://github.com/gnosis/gnosis-contracts">core smart contracts</a>, and the Gnosis JS library in the context of a <a class="reference external" href="https://github.com/gnosis/gnosis-management">user interface</a> we’ve been developing (we’ve also created a <a class="reference external" href="https://github.com/gnosis/olympia-interface">separate repository</a> for the interface used in the original tournament run, but the work done there is slated to be refactored into a feature flag for the generic interface).</p>
<p>This tutorial will detail the configuration and operation of such a tournament. In addition to the requirements listed in the introduction of the developer guide, you will also probably want to use <a class="reference external" href="https://git-scm.com/">Git</a>, and you will need to have <a class="reference external" href="https://docs.docker.com/install/">Docker</a> and <a class="reference external" href="https://docs.docker.com/compose/install/">Docker Compose</a> installed for <a class="reference external" href="https://github.com/gnosis/gnosisdb">GnosisDB</a>.</p>
<div class="section" id="smart-contracts">
<span id="smart-contracts"></span><h2>Smart Contracts<a class="headerlink" href="#smart-contracts" title="Permalink to this headline">¶</a></h2>
<p>First, you will want to deploy contracts necessary for the tournament. These contracts can be found in the <a class="reference external" href="https://github.com/gnosis/olympia-token"><code class="docutils literal notranslate"><span class="pre">olympia-token</span></code></a> repository. It will likely be the case that you will want to fork this repository in order to tweak it for your own purposes, so hit that fork button. After forking it, clone your fork and open the folder in a terminal:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the SSH version; feel free to use HTTPS if you prefer</span>
git clone git@github.com:your-github-handle/olympia-token.git
<span class="nb">cd</span> olympia-token
</pre></div>
</div>
<p>You may choose instead to not fork the directory and just clone the original repo, or to forgo Git and just download the repository as a ZIP or tarball; the rest of this guide should still work regardless.</p>
<p>Have NPM install the dependencies for the repository:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm i
</pre></div>
</div>
<div class="section" id="token-contracts">
<span id="token-contracts"></span><h3>Token Contracts<a class="headerlink" href="#token-contracts" title="Permalink to this headline">¶</a></h3>
<p>After the dependencies have been installed, take a look at the <a class="reference external" href="https://github.com/gnosis/olympia-token/blob/master/contracts/OlympiaToken.sol">OlympiaToken contract</a>. You will see that this contract is more or less functionally equivalent to the <a class="reference external" href="https://github.com/gnosis/olympia-token/blob/master/contracts/PlayToken.sol">PlayToken contract</a>, except that the optional <a class="reference external" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a> fields <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">symbol</span></code>, and <code class="docutils literal notranslate"><span class="pre">decimals</span></code> have also been specified.</p>
<p>Let’s turn our attention now to the <a class="reference external" href="https://github.com/gnosis/olympia-token/blob/master/contracts/PlayToken.sol">PlayToken contract</a>. Beyond the bare minimum necessary to implement the ERC20 interface sanely, this contract also implements two other mechanics: issuing new tokens to addresses, and determining a whitelist for token transfers.</p>
<p>The ability to issue new tokens to addresses, or minting tokens, is restricted to the creator of the contract instance. This action can be performed with a call to the <code class="docutils literal notranslate"><span class="pre">issue</span></code> function, which takes an array of recipient addresses and credits them a newly minted amount of token. The token issuance may, for example, be tied into a registration process for the tournament.</p>
<p>The creator of the contract instance is also required to set up a whitelist for token transfers. This prevents arbitrary transfers of token value from one account to another. PlayTokens can be transferred only to or from the whitelisted addresses. You may use this mechanic to ensure that users can only trade on authorized markets in the tournament.</p>
<p>Due to the mechanics above, it is crucial for the integrity of the tournament that the private key used to deploy the token contract is guarded carefully, and that actions taken by the contract creator do not undermine the faith of the tournament players.</p>
<p>You may implement other token mechanics as you see fit, but that is beyond the scope of this document.</p>
<p>If you do not wish to change the token mechanics, but you do wish to change the name and symbol of the token used by your tournament, then you may do so by renaming and modifying the <a class="reference external" href="https://github.com/gnosis/olympia-token/blob/master/contracts/OlympiaToken.sol">OlympiaToken contract</a> accordingly. For example:</p>
<div class="highlight-sol notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kn">import</span> <span class="s">&quot;./PlayToken.sol&quot;</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">BigToken</span> <span class="kr">is</span> <span class="n">PlayToken</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     *  Constants</span>
<span class="cm">     */</span>
    <span class="kt">string</span> <span class="kr">public</span> <span class="kr">constant</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Big Token&quot;</span><span class="p">;</span>
    <span class="kt">string</span> <span class="kr">public</span> <span class="kr">constant</span> <span class="n">symbol</span> <span class="o">=</span> <span class="s">&quot;BIG&quot;</span><span class="p">;</span>
    <span class="kt">uint8</span> <span class="kr">public</span> <span class="kr">constant</span> <span class="n">decimals</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Make sure that everything compiles fine by running <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">compile</span></code>.</p>
<p>After changing the name, you will also want to change the deployment script <code class="docutils literal notranslate"><span class="pre">migrations/2_deploy_contracts.js</span></code> to reflect the new token which is being deployed:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nb">Math</span> <span class="o">=</span> <span class="nx">artifacts</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;Math&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">BigToken</span> <span class="o">=</span> <span class="nx">artifacts</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;BigToken&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">deployer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deployer</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nb">Math</span><span class="p">)</span>
    <span class="nx">deployer</span><span class="p">.</span><span class="nx">link</span><span class="p">(</span><span class="nb">Math</span><span class="p">,</span> <span class="nx">BigToken</span><span class="p">)</span>
    <span class="nx">deployer</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">BigToken</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You may also consider changing the test suite in <code class="docutils literal notranslate"><span class="pre">test/olympia.js</span></code> so the test suite continues to pass:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gh">diff --git a/test/olympia.js b/test/olympia.js</span>
<span class="gh">index 7ae4d15..2c33ff4 100644</span>
<span class="gd">--- a/test/olympia.js</span>
<span class="gi">+++ b/test/olympia.js</span>
<span class="gu">@@ -6,7 +6,7 @@ const _ = require(&#39;lodash&#39;)</span>
 const { wait } = require(&#39;@digix/tempo&#39;)(web3);
 
 const MathLib = artifacts.require(&#39;Math&#39;)
<span class="gd">-const OlympiaToken = artifacts.require(&#39;OlympiaToken&#39;)</span>
<span class="gi">+const BigToken = artifacts.require(&#39;BigToken&#39;)</span>
 const PlayToken = artifacts.require(&#39;PlayToken&#39;)
 PlayToken.link(MathLib)
 const AddressRegistry = artifacts.require(&#39;AddressRegistry&#39;)
<span class="gu">@@ -26,17 +26,17 @@ async function throwUnlessRejects(q) {</span>
 
 const getBlock = util.promisify(web3.eth.getBlock.bind(web3.eth))
 
<span class="gd">-contract(&#39;OlympiaToken&#39;, function(accounts) {</span>
<span class="gd">-    let olympiaToken</span>
<span class="gi">+contract(&#39;BigToken&#39;, function(accounts) {</span>
<span class="gi">+    let bigToken</span>
 
     before(async () =&gt; {
<span class="gd">-        olympiaToken = await OlympiaToken.deployed()</span>
<span class="gi">+        bigToken = await BigToken.deployed()</span>
     })
 
     it(&#39;should have the right name, symbol, and decimals&#39;, async () =&gt; {
<span class="gd">-        assert.equal(await olympiaToken.name(), &#39;Olympia Token&#39;)</span>
<span class="gd">-        assert.equal(await olympiaToken.symbol(), &#39;OLY&#39;)</span>
<span class="gd">-        assert.equal(await olympiaToken.decimals(), 18)</span>
<span class="gi">+        assert.equal(await bigToken.name(), &#39;Big Token&#39;)</span>
<span class="gi">+        assert.equal(await bigToken.symbol(), &#39;BIG&#39;)</span>
<span class="gi">+        assert.equal(await bigToken.decimals(), 18)</span>
     })
 })
 
</pre></div>
</div>
<p>Run the test suite with <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">t</span></code>.</p>
</div>
<div class="section" id="deployment-to-a-public-network">
<span id="deployment-to-a-public-network"></span><h3>Deployment to a Public Network<a class="headerlink" href="#deployment-to-a-public-network" title="Permalink to this headline">¶</a></h3>
<p>The original Olympia was conducted primarily on the <a class="reference external" href="https://www.rinkeby.io/">Rinkeby test network</a>, but the Gnosis core contracts are deployed on the other major testnets such as the Kovan and Ropsten networks. Since the other components of the stack are network-agnostic, we can deploy to any testnet we choose. For the purpose of this guide, we will be using Rinkeby, but the following discussion applies to any other network.</p>
<p>In the root directory of the <code class="docutils literal notranslate"><span class="pre">olympia-token</span></code> repository, create a new file called <code class="docutils literal notranslate"><span class="pre">truffle-local.js</span></code>. Note that this file is listed in <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> and <code class="docutils literal notranslate"><span class="pre">.npmignore</span></code>, meaning that this file will not be published by NPM, and this file will not be included in source control. Confirm that Git does not see this file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git status
On branch master
Your branch is up to date with &#39;origin/master&#39;.

nothing to commit, working tree clean
</pre></div>
</div>
<p>Recall the previous discussion about how the private key used to deploy the token contract should be guarded carefully and keep this requirement in mind for the next few steps.</p>
<p><a class="reference external" href="https://github.com/trufflesuite/truffle-hdwallet-provider"><code class="docutils literal notranslate"><span class="pre">truffle-hdwallet-provider</span></code></a> should be installed locally in this repository as a result of the previous invocation of <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span></code>. This allows one to use a 12-word BIP39 mnemonic to derive a keypair and its associated Ethereum address for use on the network.</p>
<p>Need one on the fly? One trick to get one is to run Ganache CLI for a moment and quit it with Ctrl+C:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./node_modules/.bin/ganache-cli # I am running the local copy here, but you can use a global instance if you have one
Ganache CLI v6.0.3 (ganache-core: 2.0.2)

Available Accounts
==================
(0) 0xae2e104a271b96bee7fe31a7b687ddf48d120356
(1) 0x0e9d59b93a926c69e27c1077922c5e7209ad394b
(2) 0xf7f92f008fc87904187848f974bf0098c12c47fe
(3) 0x3214ad4c80c811b70bc1b353629db600af9fb2d4
(4) 0xb88c372207ee6c9327172af708ab39a9245a8039
(5) 0xbb647223aeca95fe1136fc9f48d49f71362fe448
(6) 0xe4052566e33bdbc4ec064849c7f0e0261256af9f
(7) 0x8c21c0d69a6abfcea2622808fc531cdba35055cc
(8) 0xd37b370fd6d587e8e55291b3ad10356e0e65a68e
(9) 0x16bb5d6be20591cd195aa8f2a095ec0487097dcc

Private Keys
==================
(0) 9aa38d11d23c7b940a7b2e0c58062a523790544b7cfb9263dff29afa019b92cd
(1) 6e88319718d77b2f68bfd5f1c188e46376b570b183c38e6768404b92d8b996eb
(2) 93b082f3270e81f135b8e61a8a38d0a6169e3a03131ebe01f4f81ef65b3a2aa7
(3) deae1e8979887b63695e859314512b6ce5860fe6711ea336f0fe5d78daa2e6be
(4) df86e8b58835d5cf89c63b0a9a53b2daa2a7935b40aacaddf460741e62214948
(5) 1ee2d31adad0e339897fe8d7cd4a40114897d23695e9ad9bd524f7838bc79318
(6) eb354ca869dcbc18bfffe07a2ed2ed0729037f1fd6f70e13e5d304b499fe9215
(7) 462d24f7e3bba9bd0359de079d520acd60e292b3d79003294b90dc7322b82157
(8) f9bac61df108a401dc43962c2b4bc57cfab78967e75715f1730662c425c9f08d
(9) 1e46ba6f2a2f59a588546de65372c9de89771934ec20927b26d47027c6089e4f

HD Wallet
==================
Mnemonic:      romance spirit scissors guard buddy rough cabin paddle cricket cactus clock buddy
Base HD Path:  m/44&#39;/60&#39;/0&#39;/0/{account_index}

Listening on localhost:8545
</pre></div>
</div>
<p>Take note of the list of addresses and the mnemonic, which in this instance is <code class="docutils literal notranslate"><span class="pre">romance</span> <span class="pre">spirit</span> <span class="pre">scissors</span> <span class="pre">guard</span> <span class="pre">buddy</span> <span class="pre">rough</span> <span class="pre">cabin</span> <span class="pre">paddle</span> <span class="pre">cricket</span> <span class="pre">cactus</span> <span class="pre">clock</span> <span class="pre">buddy</span></code>.</p>
<p>Go ahead and put the following in <code class="docutils literal notranslate"><span class="pre">truffle-local.js</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">HDWalletProvider</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;truffle-hdwallet-provider&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="s1">&#39;romance spirit scissors guard buddy rough cabin paddle cricket cactus clock buddy&#39;</span>
<span class="kr">const</span> <span class="nx">infuraAccessKey</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="kr">const</span> <span class="nx">accountIndex</span> <span class="o">=</span> <span class="mi">7</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">networks</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">rinkeby</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">provider</span><span class="o">:</span> <span class="k">new</span> <span class="nx">HDWalletProvider</span><span class="p">(</span><span class="nx">mnemonic</span><span class="p">,</span> <span class="sb">`https://rinkeby.infura.io/</span><span class="si">${</span> <span class="nx">infuraAccessKey</span> <span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="nx">accountIndex</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The account used for the deployment will be associated with the <code class="docutils literal notranslate"><span class="pre">mnemonic</span></code> and the <code class="docutils literal notranslate"><span class="pre">accountIndex</span></code> specified above (note that this index is 7 in this example). Therefore, the address which does the deployment will be <code class="docutils literal notranslate"><span class="pre">0x8c21c0d69a6abfcea2622808fc531cdba35055cc</span></code>.</p>
<p>Also note that we will, for the purposes of this tutorial, be relying on the infrastructure provided by <a class="reference external" href="https://infura.io">INFURA</a>. You may sign up and get an INFURA access key for free if you’d like.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">compile</span></code> to check that there aren’t any basic scripting errors that have been introduced while writing <code class="docutils literal notranslate"><span class="pre">truffle-local.js</span></code>. Then run <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">migrate</span> <span class="pre">--</span> <span class="pre">--network</span> <span class="pre">rinkeby</span></code> to deploy the contracts using the scripts in the <code class="docutils literal notranslate"><span class="pre">migrations</span></code> folder.</p>
<p>Assuming you haven’t funded your account with test ether yet, you will probably get an error like the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; truffle migrate &quot;--network&quot; &quot;rinkeby&quot;

Using network &#39;rinkeby&#39;.

Running migration: 1_initial_migration.js
  Deploying Migrations...
Error encountered, bailing. Network state unknown. Review successful transactions manually.
insufficient funds for gas * price + value
</pre></div>
</div>
<p>If you’re following along with this guide, go ahead and <a class="reference external" href="https://www.rinkeby.io/#faucet">get some Rinkeby test ether</a> for your account. Then try running <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">migrate</span> <span class="pre">--</span> <span class="pre">--network</span> <span class="pre">rinkeby</span></code> again. This will take a couple of minutes.</p>
<p>If you see something like the following in your terminal:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; truffle migrate &quot;--network&quot; &quot;rinkeby&quot;

Using network &#39;rinkeby&#39;.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x039e0454560f81b6373233e84e5dc5a4e6351277a85cc8767ddfb5f88cd5c3d8
  Migrations: 0x4822ea9c767071bab1f89cbeaf82d667d6bbc0c4
Saving successful migration to network...
  ... 0x1f7e4d2dbf3eed09d3a177f58dd17c5d08f0a069ab94428e0105191231f50958
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Math...
  ... 0xe7c54c4f717b9af2c55ab776c2c39ba8ec330802a63156986f4a52add272f02f
  Math: 0x42384e04beb1d2946c416f96bbd2e9f4fb4684b2
  Linking Math to BigToken
  Deploying BigToken...
  ... 0x06230721f6f061c1c08ab35aa111c4a87a5a47f3d40ca957f87b570abf400d96
  BigToken: 0xff730e9a89f39fe662c63086c986edae696f61b9
Saving successful migration to network...
  ... 0xf04ef84a08ad3f5e2c4b32c9789a61fc3ec68309f264df77d340b8472be1fcf5
Saving artifacts...
Running migration: 3_deploy_address_registry.js
  Deploying AddressRegistry...
  ... 0x2971a6e9f611b5cae5b7c0687402156b044993af8f1be58789b05999a5ade910
  AddressRegistry: 0xb36e4d8b39c2bf89ba4b76bf2a952656c40fdf1f
Saving successful migration to network...
  ... 0xbc552bee40c0db8ff0cd81008180a91e9138742c0ce1caa4ee5ba37da1b511b5
Saving artifacts...
</pre></div>
</div>
<p>then everything went well, and your contracts are now deployed on Rinkeby!</p>
</div>
<div class="section" id="preserving-deployment-information-in-published-packages">
<span id="preserving-deployment-information-in-published-packages"></span><h3>Preserving Deployment Information in Published Packages<a class="headerlink" href="#preserving-deployment-information-in-published-packages" title="Permalink to this headline">¶</a></h3>
<p>After running the migration, Truffle places the deployed addresses inside of the build artifacts located in <code class="docutils literal notranslate"><span class="pre">build/contracts</span></code>. These build artifacts are JSON files which, when converted to a plain JS object and passed as an argument to <a class="reference external" href="https://github.com/trufflesuite/truffle-contract"><code class="docutils literal notranslate"><span class="pre">truffle-contract</span></code></a>, yields a Truffle contract abstraction which may be used in decentralized application clients.</p>
<p>The deployment execution in the last section resulted in a unique set of addresses which must be distributed to clients, so how do we preserve this deployment information? For example, you may have noticed that <code class="docutils literal notranslate"><span class="pre">BigToken</span></code> was deployed onto Rinkeby at the address <a class="reference external" href="https://rinkeby.etherscan.io/address/0xff730e9a89f39fe662c63086c986edae696f61b9"><code class="docutils literal notranslate"><span class="pre">0xff7...</span></code></a>. You may run <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">networks</span></code> to see a list of the most recent deployment locations:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; truffle networks


Network: rinkeby (id: 4)
  AddressRegistry: 0xb36e4d8b39c2bf89ba4b76bf2a952656c40fdf1f
  BigToken: 0xff730e9a89f39fe662c63086c986edae696f61b9
  Math: 0x42384e04beb1d2946c416f96bbd2e9f4fb4684b2
  Migrations: 0x4822ea9c767071bab1f89cbeaf82d667d6bbc0c4
</pre></div>
</div>
<p>You may also verify that the <code class="docutils literal notranslate"><span class="pre">networks</span></code> key in the build artifacts contains (and in fact is the source of) this information. In fact, if Rinkeby is the only network displayed as a result of your running the migration, you’re ready to publish your contract deployment information. However, for the sake of completeness, let’s migrate the contracts onto a different chain.</p>
<p>In a different terminal tab, run <code class="docutils literal notranslate"><span class="pre">./node_modules/.bin/ganache-cli</span></code> (or <code class="docutils literal notranslate"><span class="pre">ganache-cli</span></code> if you have it globally, <code class="docutils literal notranslate"><span class="pre">testrpc</span></code>, or full <a class="reference external" href="http://truffleframework.com/ganache/"><code class="docutils literal notranslate"><span class="pre">ganache</span></code></a> would probably work too). Then, switch back and run <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">migrate</span></code>. Note that this runs on the default chain, which is just whatever is on <code class="docutils literal notranslate"><span class="pre">localhost:8545</span></code>. After the migration completes, check <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">networks</span></code> again:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; truffle networks


The following networks are configured to match any network id (&#39;*&#39;):

    development

Closely inspect the deployed networks below, and use `truffle networks --clean` to remove any networks that don&#39;t match your configuration. You should not use the wildcard configuration (&#39;*&#39;) for staging and production networks for which you intend to deploy your application.

Network: UNKNOWN (id: 1521428953603)
  AddressRegistry: 0xf25881f8491edc65b276d0584d34a28574fe0873
  BigToken: 0x8da9a75d1ff8bcd3940579e5aed39825967ab0ff
  Math: 0xd87d9ae40266066934e136036869512e393a507b
  Migrations: 0xbcc888cd0ec7ce6947e13d6a587090580186de5c

Network: rinkeby (id: 4)
  AddressRegistry: 0xb36e4d8b39c2bf89ba4b76bf2a952656c40fdf1f
  BigToken: 0xff730e9a89f39fe662c63086c986edae696f61b9
  Math: 0x42384e04beb1d2946c416f96bbd2e9f4fb4684b2
  Migrations: 0x4822ea9c767071bab1f89cbeaf82d667d6bbc0c4
</pre></div>
</div>
<p>Your build artifacts have grown to contain deployment info for the migration done against the test chain. Of course, in the context of package publication, this is unnecessary bloat. In order to follow the advice displayed, we can use <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">networks</span> <span class="pre">--</span> <span class="pre">--clean</span></code>. The extra <code class="docutils literal notranslate"><span class="pre">--</span></code> allows us to pass the <code class="docutils literal notranslate"><span class="pre">--clean</span></code> option down to the underlying <code class="docutils literal notranslate"><span class="pre">truffle</span> <span class="pre">networks</span></code> call.</p>
<p>After running the networks script with the clean option, <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">networks</span></code> reports that we only have Rinkeby information in the build artifacts again.</p>
<p>You may notice that the <code class="docutils literal notranslate"><span class="pre">build</span></code> folder is also ignored by Git since it is listed in the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file. However, this folder is <em>not</em> ignored by NPM because of an <code class="docutils literal notranslate"><span class="pre">.npmignore</span></code> file which does not list the <code class="docutils literal notranslate"><span class="pre">build</span></code> folder. This means that distributions of this repo on NPM will also contain the <code class="docutils literal notranslate"><span class="pre">build</span></code> folder, but the <code class="docutils literal notranslate"><span class="pre">build</span></code> folder will not be checked into source control.</p>
<p>However, while compilation results may not belong in source control, this information about deployment addresses <em>should</em> be checked in. In order to achieve this, we can use a script included with <code class="docutils literal notranslate"><span class="pre">olympia-token</span></code> to extract this information from the build artifacts into a file which sits outside of the Git ignore list:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm run extractnetinfo
</pre></div>
</div>
<p>Running this command will create or overwrite <code class="docutils literal notranslate"><span class="pre">networks.json</span></code> with all of the network information contained in the build artifacts. This is the file which should be checked into version control. Once we have this, build artifacts containing the deployment information for the Rinkeby network can be restored from plain build artifacts:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm run injectnetinfo
</pre></div>
</div>
<p>Furthermore, if there are future deployments which clutter or overwrite existing deployment information, the build artifacts can still be reset to this point:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>npm run resetnetinfo
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">resetnetinfo</span></code> is invoked as part of <code class="docutils literal notranslate"><span class="pre">prepublishOnly</span></code> to ensure that build artifacts published on NPM contain just the deployment information required for dapp clients.</p>
</div>
<div class="section" id="tying-a-bow-and-shipping-it">
<span id="tying-a-bow-and-shipping-it"></span><h3>Tying a Bow and Shipping It<a class="headerlink" href="#tying-a-bow-and-shipping-it" title="Permalink to this headline">¶</a></h3>
<p>First, let’s make sure that the package is, well, a complete package. Open up a Node shell and try to import this package by <code class="docutils literal notranslate"><span class="pre">require</span></code>-ing the directory:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ node
&gt; require<span class="o">(</span><span class="s1">&#39;.&#39;</span><span class="o">)</span>
Error: Cannot find module <span class="s1">&#39;./build/contracts/OlympiaToken.json&#39;</span>
    at Function.Module._resolveFilename <span class="o">(</span>module.js:555:15<span class="o">)</span>
    at Function.Module._load <span class="o">(</span>module.js:482:25<span class="o">)</span>
    at Module.require <span class="o">(</span>module.js:604:17<span class="o">)</span>
    at require <span class="o">(</span>internal/module.js:11:18<span class="o">)</span>
    at module.exports.reduce <span class="o">(</span>/path/to/olympia-token/index.js:6:28<span class="o">)</span>
    at Array.reduce <span class="o">(</span>&lt;anonymous&gt;<span class="o">)</span>
&gt; 
</pre></div>
</div>
<p>You may get an error as shown above if you renamed <code class="docutils literal notranslate"><span class="pre">OlympiaToken</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">package.json</span></code> refers the <code class="docutils literal notranslate"><span class="pre">index.js</span></code> file as the <code class="docutils literal notranslate"><span class="pre">main</span></code> entry point for this package, which is why the file showed up in the stack trace. It seems that the source file expects to find the <code class="docutils literal notranslate"><span class="pre">OlympiaToken.json</span></code> build artifact, but since <code class="docutils literal notranslate"><span class="pre">OlympiaToken</span></code> was renamed to <code class="docutils literal notranslate"><span class="pre">BigToken</span></code>, it really should be trying to grab <code class="docutils literal notranslate"><span class="pre">BigToken.json</span></code>. Let’s change <code class="docutils literal notranslate"><span class="pre">index.js</span></code> to do that now:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;AddressRegistry&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BigToken&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PlayToken&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RewardClaimHandler&#39;</span>
<span class="p">].</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">o</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="sb">`./build/contracts/</span><span class="si">${</span> <span class="nx">n</span> <span class="si">}</span><span class="sb">.json`</span><span class="p">),</span> <span class="nx">o</span><span class="p">),</span> <span class="p">{})</span>
</pre></div>
</div>
<p>With that out of the way (or if you originally left things named the way they were), you should see something like the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ node
&gt; require<span class="o">(</span><span class="s1">&#39;.&#39;</span><span class="o">)</span>
<span class="o">{</span> AddressRegistry: 
   <span class="o">{</span> contract_name: <span class="s1">&#39;AddressRegistry&#39;</span>,
     abi: <span class="o">[</span> <span class="o">[</span>Object<span class="o">]</span>, <span class="o">[</span>Object<span class="o">]</span>, <span class="o">[</span>Object<span class="o">]</span> <span class="o">]</span>,
     unlinked_binary: <span class="s1">&#39;0x6060...&#39;</span>,
     ...,
   <span class="o">}</span>, ... <span class="o">}</span>
</pre></div>
</div>
<p>Basically, what you get from importing the package is an object containing build artifacts for the four contracts listed in <code class="docutils literal notranslate"><span class="pre">index.js</span></code>. Those build artifacts may be, for example, used with <code class="docutils literal notranslate"><span class="pre">truffle-contract</span></code> to furnish a client with the ability to interact with the contracts you’ve deployed onto the blockchain.</p>
<p>Go ahead, edit the <code class="docutils literal notranslate"><span class="pre">package.json</span></code> to your liking, give it a test spin with <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span></code>, and then ship it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ npm publish

&gt; big-token@1.2.1 prepublishOnly .
&gt; truffle compile &amp;&amp; truffle networks --clean &amp;&amp; node scripts/inject_network_info.js

+ big-token@1.2.1
</pre></div>
</div>
<p>(By the way, <code class="docutils literal notranslate"><span class="pre">big-token</span></code> is taken, so find your own name ;)</p>
</div>
</div>
<div class="section" id="gnosisdb">
<span id="gnosisdb"></span><h2>GnosisDB<a class="headerlink" href="#gnosisdb" title="Permalink to this headline">¶</a></h2>
<p>Ethereum blockchain providers expose a common interface for querying, but to query blockchain providers directly for tournament-related info would be much too slow. That’s why we’ve developed <a class="reference external" href="https://github.com/gnosis/gnosisdb">GnosisDB</a>, which syncs up with and queries a blockchain provider directly, filtering related data into an indexed database which provides great boosts in speed when querying the database.</p>
<p>Let’s follow along with the GnosisDB setup instructions. First, ensure that <a class="reference external" href="https://docs.docker.com/install/">Docker</a> and <a class="reference external" href="https://docs.docker.com/compose/install/">Docker Compose</a> are installed.</p>
<p>Then, make sure you’re not inside of a repository directory, clone GnosisDB, and <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the newly cloned repo:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> .. <span class="c1"># assuming you&#39;re still in the olympia-token directory you created previously</span>
git clone git@github.com:gnosis/gnosisdb.git
<span class="nb">cd</span> gnosisdb
</pre></div>
</div>
<p>Then, have Docker build the container images.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker-compose build --force-rm
</pre></div>
</div>
<p>You may see the following error:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ docker-compose build --force-rm
Building ipfs
ERROR: Couldn&#39;t connect to Docker daemon at http+docker://localunixsocket - is it running?

If it&#39;s at a non-standard location, specify the URL with the DOCKER_HOST environment variable.
</pre></div>
</div>
<p>If so, it may be that your current user does not have permission to connect to the Docker daemon. If that’s the case, consider <a class="reference external" href="https://askubuntu.com/questions/477551/how-can-i-use-docker-without-sudo#477554">this answer</a>, or run <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.</p>
<p>If the build succeeds, we next want to configure the web container instance by adding a superuser so that we have admin access to the database:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker-compose run web bash
</pre></div>
</div>
<p>This makes us the root user of a shell inside of the web container:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>root@e7f35cc2dc18:/gnosisdb# 
</pre></div>
</div>
<p>Using that shell, we migrate the database schema and create a superuser:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python manage.py migrate
python manage.py createsuperuser
</pre></div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">exit</span></code> the web container shell and spin up all the GnosisDB Docker images:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker-compose up
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-interface">
<span id="setting-up-the-interface"></span><h2>Setting Up the Interface<a class="headerlink" href="#setting-up-the-interface" title="Permalink to this headline">¶</a></h2>
<p>WIP</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api-reference.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lmsr-primer.html" class="btn btn-neutral" title="LMSR Primer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Gnosis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>